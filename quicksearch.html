<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"index.js.html":{"id":"index.js.html","title":"Source: index.js","body":" ZeroFrameJS Classes ZeroFrame Source: index.js import recursiveAssign from 'recursive-object-assign' import WebSocket from 'isomorphic-ws' import fetch from 'cross-fetch' const CMD_RESPONSE = 'response' const CMD_PING = 'ping' const CMD_PONG = 'pong' /** * Client class for ZeroFrame WebSocket. */ class ZeroFrame { // Initialization &amp; Connection /** * Construct the class and set up a connection to the WebSocket server. * * @param {string} site - Target ZeroNet site address * @param {ZeroFrame#constructorOptions} [options=ZeroFrame#constructorOptions] - Client options */ constructor (site, options = {}) { options = recursiveAssign(ZeroFrame.constructorOptions, options) if (!site) { throw new Error('Site address is not specified') } this.site = site this.multiuser = options.multiuser this.instance = options.instance this.show = options.show this.reconnect = options.reconnect this.websocketConnected = false this.websocketClosing = false this.waitingCallbacks = {} this.waitingMessages = [] this.nextMessageId = 1 this.nextAttemptId = 1 /** * Proxy for accessing ZeroFrame commands. * * Command name is accepted as an object's property and parameters are accepted as * a method's arguments. Command returns `Promise` with the result. * * * Command with no arguments can be accessed with `zeroframe.proxy.cmdName()`. * * Command with keyword arguments can be accessed with `zeroframe.proxy.cmdName({key1: value1, key2: value2})`. * * Command with normal arguments can be accessed with `zeroframe.proxy.cmdName(value1, value2)`. * * @name ZeroFrame#proxy * @type Proxy */ this.proxy = new Proxy(this, { get: function get (target, name) { return function () { if (arguments.length === 0) { return target.cmdp(name) } if (arguments.length === 1 &amp;&amp; typeof arguments[0] === 'object' &amp;&amp; arguments[0] !== null) { return target.cmdp(name, arguments[0]) } const params = Array.prototype.slice.call(arguments) return target.cmdp(name, params) } } }) this._connect() } /** * User-based initialization code. * * @return {ZeroFrame} */ init () { return this } /** * Get wrapper key and connect to WebSocket. * * @return {ZeroFrame} * * @private */ async _connect () { this.wrapperKey = await this._getWrapperKey() this.websocket = await this._getWebsocket() return this.init() } /** * Get and return wrapper key. * * @return {string} - Wrapper key * * @private */ async _getWrapperKey () { const siteUrl = 'http' + (this.instance.secure ? 's' : '') + '://' + this.instance.host + ':' + this.instance.port + '/' + this.site const wrapperRequest = await fetch(siteUrl, { headers: { Accept: 'text/html' } }) const wrapperBody = await wrapperRequest.text() const wrapperKey = wrapperBody.match(/wrapper_key = \"(.*?)\"/)[1] return wrapperKey } /** * Connect and return WebSocket. * * @return {object} - WebSocket connection * * @private */ async _getWebsocket () { const wsUrl = 'ws' + (this.instance.secure ? 's' : '') + '://' + this.instance.host + ':' + this.instance.port + '/Websocket?wrapper_key=' + this.wrapperKey let wsClient if (!this.multiuser.masterAddress) { wsClient = new WebSocket(wsUrl) } else { wsClient = new WebSocket(wsUrl, [], { headers: { Cookie: 'master_address=' + this.multiuser.masterAddress } }) } wsClient.onmessage = this._onRequest.bind(this) wsClient.onopen = this._onOpenWebsocket.bind(this) wsClient.onerror = this._onErrorWebsocket.bind(this) wsClient.onclose = this._onCloseWebsocket.bind(this) return wsClient } // Internal handlers /** * Internal on request handler. * * It is triggered on every message from the WebSocket server. * It handles built-in commands and forwards others * to the user-based handler. * * @see ZeroFrame#onRequest * * @param {MessageEvent} event - Message event from the WebSocket library * * @return {void} * * @private */ _onRequest (event) { const message = JSON.parse(event.data) const cmd = message.cmd if (cmd === CMD_RESPONSE) { if (this.waitingCallbacks[message.to] !== undefined) { this.waitingCallbacks[message.to](message.result) delete this.waitingCallbacks[message.to] } } else if (cmd === CMD_PING) { this.response(message.id, CMD_PONG) } else { this.onRequest(cmd, message) } } /** * Internal on open websocket handler. * * It is triggered when the WebSocket connection is opened. * It sends waiting message and calls the user-based handler. * * @see ZeroFrame#onOpenWebsocket * * @param {OpenEvent} event - Open event from the WebSocket library * * @return {void} * * @private */ _onOpenWebsocket (event) { this.websocketConnected = true this.waitingMessages.forEach((message) =&gt; { if (!message.processed) { this.websocket.send(JSON.stringify(message)) message.processed = true } }) this.onOpenWebsocket(event) } /** * Internal on error websocket handler. * * It is triggered on the WebSocket error. It calls the user-based client. * * @see ZeroFrame#onErrorWebsocket * * @param {ErrorEvent} event - Error event from the WebSocket library * * @return {void} * * @private */ _onErrorWebsocket (event) { this.onErrorWebsocket(event) } /** * Internal on close websocket handler. * * It is triggered when the WebSocket connection is closed. * It tries to reconnect if enabled and calls the user-based handler. * * @see ZeroFrame#onCloseWebsocket * * @param {CloseEvent} event - Close event from the WebSocket library * * @return {void} * * @private */ _onCloseWebsocket (event) { this.websocketConnected = false this.onCloseWebsocket(event) // Don't attempt reconnection if user closes socket if (this.websocketClosing) return if (this.reconnect.attempts === 0) { return } if (this.reconnect.attempts !== -1 &amp;&amp; this.nextAttemptId &gt; this.reconnect.attempts) { return } setTimeout(async () =&gt; { this.websocket = await this._getWebsocket() }, this.reconnect.delay) } // External handlers /** * User-based on request handler. * * It is triggered on every message from the WebSocket server. * It can be used to add additional functionalities to * the client or handle received messages. * * @param {string} cmd - Name of received command * @param {object} message - Message of received command * * @return {void} */ onRequest (cmd, message) { this.log('Unknown request', message) } /** * User-based on open websocket handler. * * It is triggered when the WebSocket connection is opened. * It can be used to notify user or check for server details. * * @param {OpenEvent} event - Open event from the WebSocket library * * @return {void} */ onOpenWebsocket (event) { this.log('Websocket open') } /** * User-based on error websocket handler. * * It is triggered on the WebSocket error. * It can be used to notify user or display errors. * * @param {ErrorEvent} event - Error event from the WebSocket library */ onErrorWebsocket (event) { this.error('Websocket error') } /** * User-based on close websocket handler. * * It is triggered when the WebSocket connection is closed. * It can be used to notify user or display connection error. * * @param {CloseEvent} event - Close event from the WebSocket library */ onCloseWebsocket (event) { this.log('Websocket close') } // Logging functions /** * Add log to console if enabled. * * @param {...*} args Logs to add to console * * @return {void} */ log (...args) { if (this.show.log) { console.log.apply(console, ['[ZeroFrame]'].concat(args)) } } /** * Add error to console if enabled. * * @param {...*} args Errors to add to console * * @return {void} */ error (...args) { if (this.show.error) { console.error.apply(console, ['[ZeroFrame]'].concat(args)) } } // Command functions /** * Callback with command result. * * Result will depend on called command. * * In most cases, the result will be object which contains data. * Some commands don't have any result. In this case, the result * will probably be string `ok`. * * @see {@link https://zeronet.io/docs/site_development/zeroframe_api_reference/|ZeroFrame API Reference} * * @typedef {function((object|string))} ZeroFrame#cmdCallback * @callback ZeroFrame#cmdCallback * * @param {object|string} [result] - Result from command * * @return {void} */ /** * Internally send raw message to ZeroFrame server and call callback. * * If the connection is available, it directly sends a message. If the * connection is not available, it adds message to waiting message queue. * * @see ZeroFrame#cmd * @see ZeroFrame#cmdp * @see ZeroFrame#response * * @param {object} message - Message to send * @param {ZeroFrame#cmdCallback} [cb] - Message callback * * @return {void} * * @private */ _send (message, cb = null) { if (!message.id) { message.id = this.nextMessageId this.nextMessageId++ } if (this.websocketConnected) { this.websocket.send(JSON.stringify(message)) } else { this.waitingMessages.push(message) } if (cb) { this.waitingCallbacks[message.id] = cb } } /** * Send command to ZeroFrame server and call callback. * * @param {string} cmd - Name of command to send * @param {object} [params] - Parameters of command to send * @param {ZeroFrame#cmdCallback} [cb] - Command callback * * @return {void} */ cmd (cmd, params = {}, cb = null) { this._send({ cmd: cmd, params: params }, cb) } /** * Send command to ZeroFrame server and return the result as promise. * * In most cases, the result will be object which contains data. * Some commands don't have any result. In this case, the result * will probably be string `ok`. * * @see {@link https://zeronet.io/docs/site_development/zeroframe_api_reference/|ZeroFrame API Reference} * * @param {string} cmd - Name of command to send * @param {object} [params] - Parameters of command to send * * @return {Promise&lt;(object|string)&gt;} Command response */ cmdp (cmd, params = {}) { return new Promise((resolve, reject) =&gt; { this.cmd(cmd, params, (response) =&gt; { if (response &amp;&amp; response.error) { reject(response.error) } else { resolve(response) } }) }) } /** * Response to ZeroFrame message. * * @param {number} cmd - Message ID to response * @param {object} result - Result to send * * @return {void} */ response (to, result) { this._send({ cmd: CMD_RESPONSE, to: to, result: result }) } /** * Close websocket connection. * * @return {void} */ close () { this.websocketClosing = true this.websocket.close() this.onCloseWebsocket() } } /** * Constructor's options structure with default values. * * @typedef {object} ZeroFrame#constructorOptions * @name ZeroFrame#constructorOptions * * @property {object} [multiuser] - Multiuser options * @property {string} [multiuser.masterAddress=null] - Master address for multiuser ZeroNet instance * @property {string} [multiuser.masterSeed=null] - Master seed for multiuser ZeroNet instance * * @property {object} [instance] - Instance options * @property {string} [instance.host=127.0.0.1] - Host of ZeroNet instance * @property {number} [instance.port=43110] - Port of ZeroNet instance * @property {boolean} [instance.secure=false] - Secure connection of ZeroNet instance * * @property {object} [show] - Showing options * @property {boolean} [show.log=false] - Show log messages in console * @property {boolean} [show.error=false] - Show error messages in console * * @property {object} [reconnect] - Reconnecting options * @property {number} [reconnect.attempts=-1] - Number of attempts (no limit with `-1` &amp; no reconnect with `0`) * @property {number} [reconnect.delay=5000] - Number of delay in milliseconds */ ZeroFrame.constructorOptions = { multiuser: { masterAddress: null, masterSeed: null }, instance: { host: '127.0.0.1', port: 43110, secure: false }, show: { log: false, error: false }, reconnect: { attempts: -1, delay: 5000 } } try { module.exports = ZeroFrame } catch (err) { } export default ZeroFrame × Search results Close Documentation generated by JSDoc 3.6.4 on 2020-04-28 using the DocStrap template. "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" ZeroFrameJS Classes ZeroFrame Classes Classes ZeroFrame × Search results Close Documentation generated by JSDoc 3.6.4 on 2020-04-28 using the DocStrap template. "},"index.html":{"id":"index.html","title":"Index","body":" ZeroFrameJS Classes ZeroFrame ZeroFrameJS ZeroFrame WebSocket API for JavaScript. Description This is JavaScript WebSocket client for ZeroFrame API. It supports (almost) same features as default ZeroFrame that is included in ZeroNet sites, but it is using WebSocket client so it can be used in local programs, such as Node.js and Electron. It can't be used in browsers because of CORS restrictions. Installation Requirements ZeroFrameJS requires Node.js 8 or higher. With Yarn The recommended way to install ZeroFrameJS is with Yarn. yarn add zeroframe-ws-client With NPM Alternatively, you can also install it with NPM but it won't respect yarn.lock file. npm install --save zeroframe-ws-client Usage Importing Package You can import ZeroFrameJS with CJS or ESM. const ZeroFrame = require('zeroframe-ws-client') // Using CJS import ZeroFrame from 'zeroframe-ws-client' // Using ESM Creating Connection To create a connection, you need to specify the ZeroNet site address. const zeroframe = new ZeroFrame('1HeLLo4uzjaLetFx6NH3PMwFP3qbRbTf3D') If ZeroNet instance is using Multiuser plugin, you need to specify a master address of the account you want to use. Account must already exist on the instance. const zeroframe = new ZeroFrame( '1HeLLo4uzjaLetFx6NH3PMwFP3qbRbTf3D', { multiuser: { masterAddress: '1Hxki73XprDRedUdA3Remm3kBX5FZxhFR3' } }) If you want to create a new account, you also need to specify a master seed of it. Note that this feature is unsafe on the untrusted proxy. Also, it is currently not implemented yet. const zeroframe = new ZeroFrame( '1HeLLo4uzjaLetFx6NH3PMwFP3qbRbTf3D', { multiuser: { masterAddress: '1KAtuzxwbD1QuMHMuXWcUdoo5ppc5wnot9', masterSeed: 'fdbaf75427ba69a3d4aa8e19372e05879e9e2d866e579dd30be25e6fab7e3fb2' } }) If needed, you can also specify protocol, host and port of ZeroNet instance. const zeroframe = new ZeroFrame( '1HeLLo4uzjaLetFx6NH3PMwFP3qbRbTf3D', { instance: { host: '192.168.1.1', port: 8080, secure: true } }) Log and error message from zeroframe.log and zeroframe.error will not be displayed by default. If you want to, you can also display them as debug info. const zeroframe = new ZeroFrame( '1HeLLo4uzjaLetFx6NH3PMwFP3qbRbTf3D', { show: { log: true, error: true } }) By default, the client will try to reconnect WebSocket if the connection was closed every 5 seconds. You can also configure time delay and total attempts. Delay is specified in milliseconds. The number of attempts -1 means infinity and 0 means zero (disabled reconnecting). const zeroframe = new ZeroFrame( '1HeLLo4uzjaLetFx6NH3PMwFP3qbRbTf3D', { reconnect: { attempts: 10, delay: 1000 } }) The client will then obtain wrapper key to the site and connect to WebSocket using it. You can now normally use ZeroFrame API. Just remember that there is no wrapper, so wrapper commands are not available. The client is connected directly to the WebSocket server, so you need to use its commands. Note that the WebSocket server sometimes sends commands (notification, progress, error, prompt, confirm, setSiteInfo, setAnnouncerInfo, updating, redirect, injectHtml, injectScript) that are normally handled by the wrapper. Because there is no wrapper, you need to handle those commands yourself if needed. Commands response and ping are already handled by this client so you don't need to handle them. Sending Command You can use the cmd method to issue commands. zeroframe.cmd( 'siteInfo', {}, (result) =&gt; { console.log(result) } ) You can also use the cmdp method to get results as JavaScript promises. let result = await zeroframe.cmdp('siteInfo', {}) Sending Response To submit responses, you need to use response command. zeroframe.response(10, 'Hello World') Logging Information There are also log and error methods which are available for logging. They will display output to console if enabled. zeroframe.log('Connected') zeroframe.error('Connection failed') Handling Connection There are also public handler methods which you can overwrite to add your own logic to ZeroFrame. class ZeroApp extends ZeroFrame { onRequest (cmd, message) { if (cmd === 'helloWorld') { this.log('Hello World') } } onOpenWebsocket (event) { this.log('Connected to WebSocket') } onErrorWebsocket (event) { this.error('WebSocket connection error') } onCloseWebsocket (event) { this.error('WebSocket connection closed') } } Closing Connection You can use close method to close WebSocket connection to ZeroFrame API. zeroframe.close() Calling Commands Directly You can also directly call commands via Proxy object. Command name is accepted as an object's property and parameters are accepted as a method's arguments. Command returns Promise with the result. Command with no arguments can be accessed with zeroframe.proxy.cmdName(). Command with keyword arguments can be accessed with zeroframe.proxy.cmdName({key1: value1, key2: value2}). Command with normal arguments can be accessed with zeroframe.proxy.cmdName(value1, value2). let siteInfo = await zeroframe.proxy.siteInfo() Other Examples You could also look to example.js or API documentation. Versioning This library uses SemVer for versioning. For the versions available, see the tags on this repository. License This library is licensed under the MIT license. See the LICENSE file for details. × Search results Close Documentation generated by JSDoc 3.6.4 on 2020-04-28 using the DocStrap template. "},"ZeroFrame.html":{"id":"ZeroFrame.html","title":"Class: ZeroFrame","body":" ZeroFrameJS Classes ZeroFrame Class: ZeroFrame ZeroFrame Client class for ZeroFrame WebSocket. new ZeroFrame(site [, options]) Construct the class and set up a connection to the WebSocket server. Parameters: Name Type Argument Default Description site string Target ZeroNet site address options ZeroFrame#constructorOptions &lt;optional&gt; ZeroFrame#constructorOptions Client options Source: index.js, line 21 Members proxy :Proxy Proxy for accessing ZeroFrame commands. Command name is accepted as an object's property and parameters are accepted as a method's arguments. Command returns Promise with the result. Command with no arguments can be accessed with zeroframe.proxy.cmdName(). Command with keyword arguments can be accessed with zeroframe.proxy.cmdName({key1: value1, key2: value2}). Command with normal arguments can be accessed with zeroframe.proxy.cmdName(value1, value2). Type: Proxy Source: index.js, line 42 Methods init() User-based initialization code. Source: index.js, line 80 Returns: Type ZeroFrame onRequest(cmd, message) User-based on request handler. It is triggered on every message from the WebSocket server. It can be used to add additional functionalities to the client or handle received messages. Parameters: Name Type Description cmd string Name of received command message object Message of received command Source: index.js, line 267 Returns: Type void onOpenWebsocket(event) User-based on open websocket handler. It is triggered when the WebSocket connection is opened. It can be used to notify user or check for server details. Parameters: Name Type Description event OpenEvent Open event from the WebSocket library Source: index.js, line 281 Returns: Type void onErrorWebsocket(event) User-based on error websocket handler. It is triggered on the WebSocket error. It can be used to notify user or display errors. Parameters: Name Type Description event ErrorEvent Error event from the WebSocket library Source: index.js, line 293 onCloseWebsocket(event) User-based on close websocket handler. It is triggered when the WebSocket connection is closed. It can be used to notify user or display connection error. Parameters: Name Type Description event CloseEvent Close event from the WebSocket library Source: index.js, line 305 log(args) Add log to console if enabled. Parameters: Name Type Argument Description args * &lt;repeatable&gt; Logs to add to console Source: index.js, line 318 Returns: Type void error(args) Add error to console if enabled. Parameters: Name Type Argument Description args * &lt;repeatable&gt; Errors to add to console Source: index.js, line 331 Returns: Type void cmd(cmd [, params] [, cb]) Send command to ZeroFrame server and call callback. Parameters: Name Type Argument Default Description cmd string Name of command to send params object &lt;optional&gt; Parameters of command to send cb ZeroFrame#cmdCallback &lt;optional&gt; null Command callback Source: index.js, line 401 Returns: Type void cmdp(cmd [, params]) Send command to ZeroFrame server and return the result as promise. In most cases, the result will be object which contains data. Some commands don't have any result. In this case, the result will probably be string ok. Parameters: Name Type Argument Description cmd string Name of command to send params object &lt;optional&gt; Parameters of command to send Source: index.js, line 422 See: ZeroFrame API Reference Returns: Command response Type Promise.&lt;(object|string)&gt; response(cmd, result) Response to ZeroFrame message. Parameters: Name Type Description cmd number Message ID to response result object Result to send Source: index.js, line 442 Returns: Type void close() Close websocket connection. Source: index.js, line 455 Returns: Type void Type Definitions cmdCallback( [result]) Callback with command result. Result will depend on called command. In most cases, the result will be object which contains data. Some commands don't have any result. In this case, the result will probably be string ok. Parameters: Name Type Argument Description result object | string &lt;optional&gt; Result from command Source: index.js, line 339 See: ZeroFrame API Reference Returns: Type void constructorOptions Constructor's options structure with default values. Type: object Properties: Name Type Argument Description multiuser object &lt;optional&gt; Multiuser options Properties Name Type Argument Default Description masterAddress string &lt;optional&gt; null Master address for multiuser ZeroNet instance masterSeed string &lt;optional&gt; null Master seed for multiuser ZeroNet instance instance object &lt;optional&gt; Instance options Properties Name Type Argument Default Description host string &lt;optional&gt; 127.0.0.1 Host of ZeroNet instance port number &lt;optional&gt; 43110 Port of ZeroNet instance secure boolean &lt;optional&gt; false Secure connection of ZeroNet instance show object &lt;optional&gt; Showing options Properties Name Type Argument Default Description log boolean &lt;optional&gt; false Show log messages in console error boolean &lt;optional&gt; false Show error messages in console reconnect object &lt;optional&gt; Reconnecting options Properties Name Type Argument Default Description attempts number &lt;optional&gt; -1 Number of attempts (no limit with -1 &amp; no reconnect with 0) delay number &lt;optional&gt; 5000 Number of delay in milliseconds Source: index.js, line 462 × Search results Close Documentation generated by JSDoc 3.6.4 on 2020-04-28 using the DocStrap template. "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
